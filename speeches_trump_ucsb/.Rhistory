data$Term = str_extract(filename, "[0-9]+")
return( data )
}
meta <- ldply( .data = list.files(pattern="*.csv"),
.fun = readFun,
.parallel = TRUE )
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(scales)
library(data.table)
library(tidyverse)
library(lubridate)
library(plyr)
# define a function to read files while adding the candidate info
readFun <- function( filename ) {
# read in the data
data <- read.csv( filename,
header = FALSE,
col.names = c( "Link", "Title", "Date", "Location" ) )
# add a "Candidate" and "Year" column based on file name
data$Candidate <- str_match(filename, "META(.*?)[[:digit:]]")[,2]
data$Term = str_extract(filename, "[0-9]+")
return( data )
}
meta <- ldply( .data = list.files(pattern="*.csv"),
.fun = readFun,
.parallel = TRUE )
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(scales)
library(data.table)
library(tidyverse)
library(lubridate)
library(plyr)
# define a function to read files while adding the candidate info
readFun <- function( filename ) {
# read in the data
data <- read.csv( filename,
header = FALSE,
col.names = c( "Link", "Title", "Date", "Location" ) )
# add a "Candidate" and "Year" column based on file name
data$Candidate <- str_match(filename, "META(.*?)[[:digit:]]")[,2]
data$Term = str_extract(filename, "[0-9]+")
return( data )
}
# execute that function across all files, outputting a data frame
setwd("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/metaALL")
metaALL <- ldply( .data = list.files(pattern="*.csv"),
.fun = readFun,
.parallel = TRUE )
metaALL$Date = as.POSIXct(metaALL$Date)
# this is our dataset
setwd("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/meta")
meta <- ldply( .data = list.files(pattern="*.csv"),
.fun = readFun,
.parallel = TRUE )
meta$Date = as.POSIXct(meta$Date)
sub(" -speech.*", "", "kerry-speech-2004-07-29-national-convention-boston.txt")
sub("-speech.*", "", "kerry-speech-2004-07-29-national-convention-boston.txt")
str_match("kerry-speech-2004-07-29-national-convention-boston.txt", "speech-\\s*(.*?)\\s*-")
str_match("kerry-speech-2004-07-29-national-convention-boston.txt", "speech-\\s*(.*?)\\s*-")[,2]
read_file("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/speeches_bush_ucsb/bush-speech-2000-08-03-national-convention-0.txt")
strsplit(read_file("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/speeches_bush_ucsb/bush-speech-2000-08-03-national-convention-0.txt"), "\n")
folders = list.files(full.names = F , recursive = F, pattern='speeches*')
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df$texts = par
texts_df$candidate = cand
texts_df$term = term
return(text_df)
})
print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
print(path)
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df$texts = par
texts_df$candidate = cand
texts_df$term = term
return(text_df)
})
print(df)
}
setwd("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/")
folders = list.files(full.names = F , recursive = F, pattern='speeches*')
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
print(path)
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df$texts = par
texts_df$candidate = cand
texts_df$term = term
return(text_df)
})
print(df)
}
library(data.table)
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
print(path)
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df$texts = par
texts_df$candidate = cand
texts_df$term = term
return(text_df)
})
print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df$texts = par
texts_df$candidate = cand
texts_df$term = term
return(texts_df)
})
print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
print(cand)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df$texts = par
texts_df$candidate = cand
texts_df$term = term
return(texts_df)
})
print(df)
}
df
df[1]
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df[, text := par ]
texts_df$candidate = cand
texts_df$term = term
return(texts_df)
})
print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
texts_df = data.table(texts = character(), candidate = character(), term = character() )
texts_df[, texts := par ]
print(texts_df)
texts_df$candidate = cand
texts_df$term = term
return(texts_df)
})
#print(df)
}
?rep()
?rep
cand_df = rep("bush", times =5)
cand_df
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = par, candidate = cand_df, term = term_df )
return(texts_df)
})
print(df)
}
df[1]
df[[1]]
View(df)
View(df[1])
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
return(texts_df)
})
print(df)
}
View(df)
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
return(texts_df)
print(texts_df)
})
#print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
print(texts_df)
return(texts_df)
})
#print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n ")
print(length(par))
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
#print(texts_df)
return(texts_df)
})
#print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")
print(length(par))
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
#print(texts_df)
return(texts_df)
})
#print(df)
}
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
df = sapply(all_files, function(x){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
print(length(par))
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
texts_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
#print(texts_df)
return(texts_df)
})
#print(df)
}
df
df[1]
View(df[1])
list.files("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/speeches_trump_ucsb/")
length(list.files("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/speeches_trump_ucsb/"))
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
for (j in 1:length(all_files)){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}}
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = as.vector(par), candidate = cand_df, term = term_df )
for (j in 1:length(all_files)){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}
}
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = character(), candidate = character(), term = character() )
for (j in 1:length(all_files)){
t <- read_file(x) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}
}
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = character(), candidate = character(), term = character() )
for (j in 1:length(all_files)){
t <- read_file(j) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}
}
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = character(), candidate = character(), term = character() )
for (j in 1:length(all_files)){
t <- read_file(all_files[j]) # load file
cand = sub("-speech.*", "", x)
term = str_match(x, "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}}
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = character(), candidate = character(), term = character() )
for (j in 1:length(all_files)){
t <- read_file(all_files[j]) # load file
cand = sub("-speech.*", "", x)
term = str_match(all_files[j], "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}
}
for(i in 1:1){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = character(), candidate = character(), term = character() )
for (j in 1:length(all_files)){
t <- read_file(all_files[j]) # load file
cand = sub("-speech.*", "", all_files[j])
term = str_match(all_files[j], "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}}
speech_df
View(head(speech_df))
df = data.table(texts = character(), candidate = character(), term = character() )
for(i in 1:length(folders)){
path =  paste0("/Users/yuchenluo/Desktop/Measure_RadicalDiscourse/", folders[i])
setwd(path)
all_files = list.files(pattern = "*.txt")
speech_df = data.table(texts = character(), candidate = character(), term = character() )
for (j in 1:length(all_files)){
t <- read_file(all_files[j]) # load file
cand = sub("-speech.*", "", all_files[j])
term = str_match(all_files[j], "speech-\\s*(.*?)\\s*-")[,2]
par = strsplit(t, "\n")[[1]]
cand_df = rep(cand, times = length(par))
term_df = rep(term, times = length(par))
par_df = data.table(texts = par, candidate = cand_df, term = term_df )
speech_df = rbind(speech_df, par_df)
}
df = rbind(df, speech_df)
}
?count
df$n_sent = length(unlist(tokenize_sentences(df[,texts])))
library(tokenizers)
df$n_sent = length(unlist(tokenize_sentences(df[,texts])))
df$n_sent
for (i in 1:nrow(df)){
df$n_sent = length(unlist(tokenize_sentences(df[i,texts])))
}
for (i in 1:nrow(df)){
df$n_sent[i] = length(unlist(tokenize_sentences(df[i,texts])))
}
df$n_sent
ggplot(data = df, aes(x = n_sent))+
geom_histogram()
df %>% filter(n_sent<10) %>%
ggplot(aes(x = n_sent))+
geom_histogram()
df %>% filter(n_sent<10) %>%
ggplot(aes(x = n_sent))+
geom_histogram(binwidth = 1)
summary(df$n_sent)
prop.table(df$n_sent)
length(df[,n_sent <4]/nrow(df)
)
length(df[,n_sent <4])/nrow(df)
nrow(df[,n_sent <4])/nrow(df)
nrow(df[ ,as.numeric(n_sent )<4])/nrow(df)
df[ ,as.numeric(n_sent )
<4]
nrow(df[ ,as.numeric(n_sent )<4])
df[df[ ,as.numeric(n_sent )<4]]
nrow(df[df[ ,as.numeric(n_sent )<4]])
nrow(df[df[ ,as.numeric(n_sent )<4]])/nrow(df)
nrow(df[df[ ,as.numeric(n_sent )<3]])/nrow(df)
